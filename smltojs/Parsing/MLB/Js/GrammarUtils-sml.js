if ((typeof(basics$GrammarUtils$)) == "undefined") {basics$GrammarUtils$ = {};
};
(function(){basics$GrammarUtils$.impossible$85 = function(s$88){return tools$Crash$.impossible$50("GrammarUtils." + s$88);
};
basics$GrammarUtils$.inventId_from_atpat$89 = function(atpat$92){var v$97 = basics$PreElabDecGrammar$$2.find_topmost_id_in_atpat$1777(atpat$92);
switch (v$97[0]) { case 0: {var v$99 = v$97[1];
return syntax_objects$Ident$.invent_named_id$194(v$99);
 break; }default: {return syntax_objects$Ident$.inventId$192(0);
} };
};
basics$GrammarUtils$.mk_IdentLab$100 = function(v$1878){return syntax_objects$Lab$.mk_IdentLab$102(v$1878);
};
basics$GrammarUtils$.mk_IntegerLab$101 = function(v$1879){return syntax_objects$Lab$.mk_IntegerLab$104(v$1879);
};
basics$GrammarUtils$.mk_Id$102 = function(v$1880){return syntax_objects$Ident$.mk_Id$160(v$1880);
};
basics$GrammarUtils$.mk_LongId$103 = function(v$1881){return syntax_objects$Ident$.mk_LongId$162(v$1881);
};
basics$GrammarUtils$.mk_FunId$104 = function(v$1882){return syntax_objects$FunId$.mk_FunId$49(v$1882);
};
basics$GrammarUtils$.mk_StrId$105 = function(v$1883){return syntax_objects$StrId$.mk_StrId$94(v$1883);
};
basics$GrammarUtils$.mk_LongStrId$106 = function(v$1884){return syntax_objects$StrId$.mk_LongStrId$96(v$1884);
};
basics$GrammarUtils$.longStrIdOfStrId$107 = function(v$1885){return syntax_objects$StrId$.longStrIdOfStrId$121(v$1885);
};
basics$GrammarUtils$.mk_SigId$108 = function(v$1886){return syntax_objects$SigId$.mk_SigId$49(v$1886);
};
basics$GrammarUtils$.mk_TyVar$109 = function(v$1887){return syntax_objects$SyntaxTyVar$.mk_TyVar$49(v$1887);
};
basics$GrammarUtils$.mk_TyCon$110 = function(v$1888){return syntax_objects$TyCon$.mk_TyCon$131(v$1888);
};
basics$GrammarUtils$.mk_LongTyCon$111 = function(v$1889){return syntax_objects$TyCon$.mk_LongTyCon$133(v$1889);
};
basics$GrammarUtils$.mk_IntSCon$112 = function(v$113){return [3,v$113];
};
basics$GrammarUtils$.mk_WordSCon$114 = function(v$115){return [0,v$115];
};
basics$GrammarUtils$.mk_StringSCon$116 = function(v$117){return [1,v$117];
};
basics$GrammarUtils$.mk_CharSCon$118 = function(v$119){return [4,v$119];
};
basics$GrammarUtils$.mk_RealSCon$120 = function(v$121){return [2,v$121];
};
basics$GrammarUtils$.PP$122 = function(pos_l$125,pos_r$128){return basics$ParseInfo$.from_SourceInfo$58(basics$SourceInfo$.from_positions$51(pos_l$125,pos_r$128));
};
basics$GrammarUtils$.un_PP$129 = function(x$1312){return basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1312));
};
basics$GrammarUtils$.right$130 = function(x$1316){return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1316)))[1];
};
basics$GrammarUtils$.span_info$150 = function(v$155,v$156){var pos_l$1333 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$155)))[0];
var pos_r$1334 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$156)))[1];
return basics$ParseInfo$.from_SourceInfo$58(basics$SourceInfo$.from_positions$51(pos_l$1333,pos_r$1334));
};
basics$GrammarUtils$.rightmost$190 = function(v$193,v$196,v$199,v$202){switch (v$202[0]) { case 0: {var v$219 = v$202[1];
var x$1704 = v$199(v$219);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1704)))[1];
 break; }default: {var x$1706 = v$193(v$196);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1706)))[1];
} };
};
basics$GrammarUtils$.rightmost$$223 = function(v$226,v$229,v$232){switch (v$232[0]) { case 0: {var v$246 = v$232[1];
var x$1708 = v$229(v$246);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1708)))[1];
 break; }default: {return v$226;
} };
};
basics$GrammarUtils$.rightmost_of_three$249 = function(v$252,v$255,v$258,v$261,v$264){switch (v$264[0]) { case 0: {var v$287 = v$264[1];
var x$1710 = v$261(v$287);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1710)))[1];
 break; }default: {switch (v$258[0]) { case 0: {var v$292 = v$258[1];
var x$1712 = v$255(v$292);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1712)))[1];
 break; }default: {return v$252;
} };
} };
};
basics$GrammarUtils$.rightmost_of_four$297 = function(v$300,v$303,v$306,v$309,v$312,v$315,v$318){switch (v$318[0]) { case 0: {var v$352 = v$318[1];
var x$1714 = v$315(v$352);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1714)))[1];
 break; }default: {switch (v$312[0]) { case 0: {var v$358 = v$312[1];
var x$1716 = v$309(v$358);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1716)))[1];
 break; }default: {switch (v$306[0]) { case 0: {var v$364 = v$306[1];
var x$1718 = v$303(v$364);
return (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(x$1718)))[1];
 break; }default: {return v$300;
} };
} };
} };
};
var fix$1892 = {};
fix$1892.$wi_Convert = function(f$374,list$377){if (list$377 == null) {return null;
} else {var v$386 = list$377;
var v$387 = v$386[0];
var v$388 = v$387[1];
var v$389 = v$388[0];
var v$390 = v$388[1];
var v$391 = v$386[1];
return [[0,[v$389,f$374(v$390)]],fix$1892.$wi_Convert(f$374,v$391)];
};
};
basics$GrammarUtils$.wi_Convert$371 = fix$1892.$wi_Convert;
basics$GrammarUtils$.expOfAtexp$392 = function(atexp$395){return [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$395),atexp$395]];
};
basics$GrammarUtils$.patOfAtpat$396 = function(atpat$399){return [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$399),atpat$399]];
};
basics$GrammarUtils$.atexpOfIdent$400 = function(info$403,id$406){return [4,[info$403,[0,[syntax_objects$Ident$.idToLongId$201(id$406),false]]]];
};
basics$GrammarUtils$.patOfIdent$414 = function(info$417,v$421){var v$422 = v$421[0];
var v$423 = v$421[1];
var atpat$1338 = [4,[info$417,[0,[syntax_objects$Ident$.idToLongId$201(v$422),v$423]]]];
return [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1338),atpat$1338]];
};
basics$GrammarUtils$.topdecOfExp$424 = function(exp$427){var info$428 = basics$PreElabDecGrammar$$2.get_info_exp$218(exp$427);
var t$1905;
var t$1904 = info$428;
var t$1903;
var t$1902;
var t$1901 = info$428;
var t$1900;
var t$1899;
var t$1898 = info$428;
var t$1897 = null;
var t$1896;
var t$1895;
var t$1894 = info$428;
var t$1893;
var atpat$1343 = [4,[info$428,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_IT$137),false]]]];
t$1893 = [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1343),atpat$1343]];
t$1895 = [t$1894,t$1893,exp$427,[1]];
t$1896 = [1,t$1895];
t$1899 = [t$1898,t$1897,t$1896];
t$1900 = [0,t$1899];
t$1902 = [t$1901,t$1900];
t$1903 = [4,t$1902];
t$1905 = [t$1904,t$1903,[1]];
return [0,t$1905];
};
basics$GrammarUtils$.composeStrDec$433 = function(v$449,v$450,v$451){switch (v$450[0]) { case 3: {return v$451;
 break; }default: {switch (v$451[0]) { case 3: {return v$450;
 break; }default: {return [1,[v$449,v$450,v$451]];
} };
} };
};
basics$GrammarUtils$.composeSpec$452 = function(v$468,v$469,v$470){switch (v$469[0]) { case 9: {return v$470;
 break; }default: {switch (v$470[0]) { case 9: {return v$469;
 break; }default: {return [5,[v$468,v$469,v$470]];
} };
} };
};
basics$GrammarUtils$.inventStrId$471 = function(v$1890){return syntax_objects$StrId$.inventStrId$110(v$1890);
};
basics$GrammarUtils$.inventId$472 = function(v$1891){return syntax_objects$Ident$.inventId$192(v$1891);
};
basics$GrammarUtils$.composeDec$473 = function(v$489,v$490,v$491){switch (v$490[0]) { case 10: {return v$491;
 break; }default: {switch (v$491[0]) { case 10: {return v$490;
 break; }default: {return [3,[v$489,v$490,v$491]];
} };
} };
};
basics$GrammarUtils$.tuple_atexp_with_info$492 = function(info$495,exps$498){var fix$1906 = {};
fix$1906.$f = function(v$1855,v$510){if (v$510 == null) {return [1];
} else {var v$513 = v$510;
var v$514 = v$513[0];
var v$515 = v$513[1];
return [0,[0,[info$495,syntax_objects$Lab$.mk_IntegerLab$104(v$1855),v$514,fix$1906.$f(SmlPrims.chk_ovf_i32(v$1855 + 1),v$515)]]];
};
};
var f$499 = fix$1906.$f;
return [1,[info$495,f$499(1,exps$498)]];
};
basics$GrammarUtils$.tuple_atexp$516 = function(v$519){if (v$519 == null) {return tools$Crash$.impossible$50("GrammarUtils.tuple_atexp _");
} else {var v$529 = v$519;
var v$530 = v$529[1];
if (v$530 == null) {return tools$Crash$.impossible$50("GrammarUtils.tuple_atexp _");
} else {var v$534 = v$529[0];
var v$535 = v$530;
var v$536 = v$535[0];
var v$537 = v$535[1];
var info$1346;
var v$1625 = basics$PreElabDecGrammar$$2.get_info_exp$218(v$534);
var v$1626;
try {v$1626 = (basics$PreElabDecGrammar$$2.get_info_exp$218(basis$List$.last$81([v$536,v$537])));
} catch(v$1907) {v$1626 = ((function(v$533){return tools$Crash$.impossible$50("GrammarUtils.tuple_atexp: last");
})(v$1907));
};
var pos_l$1358 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1625)))[0];
var pos_r$1359 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1626)))[1];
info$1346 = (basics$ParseInfo$.from_SourceInfo$58(basics$SourceInfo$.from_positions$51(pos_l$1358,pos_r$1359)));
var exps$1347 = [v$534,[v$536,v$537]];
var fix$1908 = {};
fix$1908.$f = function(v$1856,v$1350){if (v$1350 == null) {return [1];
} else {var v$1352 = v$1350;
var v$1353 = v$1352[0];
var v$1354 = v$1352[1];
return [0,[0,[info$1346,syntax_objects$Lab$.mk_IntegerLab$104(v$1856),v$1353,fix$1908.$f(SmlPrims.chk_ovf_i32(v$1856 + 1),v$1354)]]];
};
};
var f$1348 = fix$1908.$f;
return [1,[info$1346,f$1348(1,exps$1347)]];
};
};
};
basics$GrammarUtils$.case_exp$539 = function(info$542,v$546){var v$547 = v$546[0];
var v$548 = v$546[1];
return [6,[info$542,[4,[basics$PreElabDecGrammar$$2.get_info_match$217(v$548),v$548]],[2,[basics$PreElabDecGrammar$$2.get_info_exp$218(v$547),v$547]]]];
};
basics$GrammarUtils$.sequenceExp$549 = function(exps$552){var fix$1909 = {};
fix$1909.$f = function(v$570,v$1857){if (v$570 == null) {return v$1857;
} else {var v$572 = v$570;
var v$573 = v$572[0];
var v$574 = v$572[1];
var info$1368 = basics$PreElabDecGrammar$$2.get_info_exp$218(v$573);
var v$1634;
var exp$1372 = fix$1909.$f(v$574,v$1857);
var info_exp$1373 = basics$PreElabDecGrammar$$2.get_info_exp$218(exp$1372);
v$1634 = [0,[info_exp$1373,[0,[info_exp$1373,[4,[info_exp$1373,[0,info_exp$1373]]],exp$1372]],[1]]];
return [6,[info$1368,[4,[basics$PreElabDecGrammar$$2.get_info_match$217(v$1634),v$1634]],[2,[basics$PreElabDecGrammar$$2.get_info_exp$218(v$573),v$573]]]];
};
};
var f$558 = fix$1909.$f;
var v$582 = basis$List$.rev$641(exps$552);
if (v$582 == null) {return tools$Crash$.impossible$50("GrammarUtils.sequenceExp");
} else {var v$584 = v$582;
var v$585 = v$584[0];
var v$586 = v$584[1];
return f$558(basis$List$.rev$641(v$586),v$585);
};
};
basics$GrammarUtils$.list_atexp$587 = function(info$590,exps$593){var nilExp$594;
var atexp$1378 = [4,[info$590,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_NIL$130),false]]]];
nilExp$594 = [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1378),atexp$1378]];
var consExp$595;
var atexp$1383 = [4,[info$590,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_CONS$131),false]]]];
consExp$595 = [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1383),atexp$1383]];
var fix$1910 = {};
fix$1910.$f = function(v$599){if (v$599 == null) {return nilExp$594;
} else {var v$607 = v$599;
var v$608 = v$607[0];
var v$609 = v$607[1];
return [6,[basics$PreElabDecGrammar$$2.get_info_exp$218(v$608),consExp$595,basics$GrammarUtils$.tuple_atexp$516([v$608,[fix$1910.$f(v$609),null]])]];
};
};
var f$596 = fix$1910.$f;
return [2,[info$590,f$596(exps$593)]];
};
basics$GrammarUtils$.hash$610 = function(info$613,lab$616){var id$617 = syntax_objects$Ident$.inventId$192(0);
var t$1934;
var t$1933 = info$613;
var t$1932;
var t$1931;
var t$1930 = info$613;
var t$1929;
var t$1928;
var t$1927 = info$613;
var t$1926;
var t$1925;
var t$1924 = info$613;
var t$1923;
var t$1922;
var t$1921 = info$613;
var t$1920;
var t$1919;
var t$1918 = info$613;
var t$1917;
var t$1916;
var t$1915;
var t$1914 = info$613;
var t$1913 = lab$616;
var t$1912;
var atpat$1390 = [4,[info$613,[0,[syntax_objects$Ident$.idToLongId$201(id$617),false]]]];
t$1912 = [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1390),atpat$1390]];
t$1915 = [t$1914,t$1913,t$1912,[0,[1,info$613]]];
t$1916 = [0,t$1915];
t$1917 = [0,t$1916];
t$1919 = [t$1918,t$1917];
t$1920 = [2,t$1919];
t$1922 = [t$1921,t$1920];
t$1923 = [4,t$1922];
var t$1911;
var atexp$1393 = [4,[info$613,[0,[syntax_objects$Ident$.idToLongId$201(id$617),false]]]];
t$1911 = [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1393),atexp$1393]];
t$1925 = [t$1924,t$1923,t$1911];
t$1926 = [0,t$1925];
t$1928 = [t$1927,t$1926,[1]];
t$1929 = [0,t$1928];
t$1931 = [t$1930,t$1929];
t$1932 = [4,t$1931];
t$1934 = [t$1933,t$1932];
return [2,t$1934];
};
basics$GrammarUtils$.exp_true$622 = function(info$625){var atexp$1398 = [4,[info$625,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_TRUE$132),false]]]];
return [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1398),atexp$1398]];
};
basics$GrammarUtils$.exp_false$626 = function(info$629){var atexp$1403 = [4,[info$629,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_FALSE$133),false]]]];
return [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1403),atexp$1403]];
};
basics$GrammarUtils$.exp_quote$630 = function(info$633,s$636){var t$1937;
var t$1936 = info$633;
var t$1935;
var atexp$1408 = [4,[info$633,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_QUOTE$138),false]]]];
t$1935 = [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1408),atexp$1408]];
t$1937 = [t$1936,t$1935,[0,[info$633,[1,s$636]]]];
return [6,t$1937];
};
basics$GrammarUtils$.exp_antiquote$638 = function(info$641,atexp$644){var t$1940;
var t$1939 = info$641;
var t$1938;
var atexp$1413 = [4,[info$641,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_ANTIQUOTE$139),false]]]];
t$1938 = [5,[basics$PreElabDecGrammar$$2.get_info_atexp$220(atexp$1413),atexp$1413]];
t$1940 = [t$1939,t$1938,atexp$644];
return [6,t$1940];
};
basics$GrammarUtils$.if_then_else_exp$646 = function(info$649,v$654){var v$657 = v$654[0];
var v$658 = v$654[1];
var v$659 = v$654[2];
var mruleT$655;
var t$1943;
var t$1942 = info$649;
var t$1941;
var atpat$1420 = [4,[info$649,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_TRUE$132),false]]]];
t$1941 = [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1420),atpat$1420]];
t$1943 = [t$1942,t$1941,v$658];
mruleT$655 = [0,t$1943];
var mruleF$656;
var t$1946;
var t$1945 = info$649;
var t$1944;
var atpat$1425 = [4,[info$649,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_FALSE$133),false]]]];
t$1944 = [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1425),atpat$1425]];
t$1946 = [t$1945,t$1944,v$659];
mruleF$656 = [0,t$1946];
var v$1644 = [0,[info$649,mruleT$655,[0,[0,[info$649,mruleF$656,[1]]]]]];
return [6,[info$649,[4,[basics$PreElabDecGrammar$$2.get_info_match$217(v$1644),v$1644]],[2,[basics$PreElabDecGrammar$$2.get_info_exp$218(v$657),v$657]]]];
};
basics$GrammarUtils$.while_exp$660 = function(info$663,v$667){var v$681 = v$667[0];
var v$682 = v$667[1];
var v$668 = syntax_objects$Ident$.inventLongId$198(0);
var varExp$669 = [5,[info$663,[4,[info$663,[0,[v$668,false]]]]]];
var unitAtExp$670 = [1,[info$663,[1]]];
var unitExp$671 = [5,[info$663,unitAtExp$670]];
var varPat$672 = [4,[info$663,[4,[info$663,[0,[v$668,false]]]]]];
var unitPat$673 = [4,[info$663,[2,[info$663,[1]]]]];
var callVar$674 = [6,[info$663,varExp$669,unitAtExp$670]];
return [5,[info$663,[3,[info$663,[0,[info$663,null,[0,[info$663,[1,[info$663,varPat$672,[4,[info$663,[0,[info$663,[0,[info$663,unitPat$673,basics$GrammarUtils$.if_then_else_exp$646(info$663,[v$681,basics$GrammarUtils$.sequenceExp$549([v$682,[callVar$674,null]]),unitExp$671])]],[1]]]]],[1]]]]]]],callVar$674]]]];
};
var fix$1947 = {};
fix$1947.$rewriteDatBind = function(v$1046,v$1047){var fix$1968 = {};
fix$1968.$replaceTy = function(tyvarseq$727,tyseq$730,ty$733){switch (ty$733[0]) { case 0: {var v$789 = ty$733[1];
var v$791 = v$789[1];
var i$776;
var v$781;
var fix$2008 = {};
fix$2008.$count = function(v$1849,v$1850){lab$count: while (true) {if (v$1849 == null) {return [1];
} else {var v$1851 = v$1849;
var v$1852 = v$1851[0];
var v$1853 = v$1851[1];
if (syntax_objects$SyntaxTyVar$.eq_SyntaxTyVar$116(v$1852,v$791)) {return [0,v$1850];
} else {var t$2009 = v$1853;
var t$2010 = SmlPrims.chk_ovf_i32(v$1850 + 1);
var v$1849 = t$2009;
var v$1850 = t$2010;
continue lab$count;
};
};
};
};
var count$1848 = fix$2008.$count;
v$781 = (count$1848(tyvarseq$727,0));
switch (v$781[0]) { case 0: {i$776 = v$781[1];
 break; }default: {i$776 = (tools$Crash$.unimplemented$71("No check for tyvar on rsh in lhs of withtype defined type"));
} };
try {return basis$List$.nth$98(tyseq$730,i$776);
} catch(v$2011) {return (function(v$788){return tools$Crash$.impossible$50("GrammarUtils.rewriteDatBind---replaceTy");
})(v$2011);
};
 break; }case 1: {var v$770 = ty$733[1];
var v$771 = v$770[1];
switch (v$771[0]) { case 1: {return ty$733;
 break; }default: {var v$773 = v$770[0];
var v$774 = v$771[1];
return [1,[v$773,[0,fix$1968.$replaceTyrow(tyvarseq$727,tyseq$730,v$774)]]];
} };
 break; }case 4: {var v$765 = ty$733[1];
var v$766 = v$765[0];
var v$767 = v$765[1];
var v$768 = v$765[2];
var t$2007;
var t$2006 = v$766;
var t$2005;
var fix$2004 = {};
fix$2004.$map = function(v$1441){if (v$1441 == null) {return null;
} else {var v$1442 = v$1441;
var v$1443 = v$1442[0];
var v$1444 = v$1442[1];
return [fix$1968.$replaceTy(tyvarseq$727,tyseq$730,v$1443),fix$2004.$map(v$1444)];
};
};
var map$1440 = fix$2004.$map;
t$2005 = (map$1440(v$767));
t$2007 = [t$2006,t$2005,v$768];
return [4,t$2007];
 break; }case 3: {var v$760 = ty$733[1];
var v$761 = v$760[0];
var v$762 = v$760[1];
var v$763 = v$760[2];
return [3,[v$761,fix$1968.$replaceTy(tyvarseq$727,tyseq$730,v$762),fix$1968.$replaceTy(tyvarseq$727,tyseq$730,v$763)]];
 break; }default: {var v$792 = ty$733[1];
var v$793 = v$792[0];
var v$794 = v$792[1];
return [2,[v$793,fix$1968.$replaceTy(tyvarseq$727,tyseq$730,v$794)]];
} };
};
fix$1968.$replaceTyrow = function(tyvarseq$797,tyseq$800,tyrow$803){var v$815 = tyrow$803[1];
var v$816 = v$815[3];
switch (v$816[0]) { case 1: {var v$817 = v$815[0];
var v$818 = v$815[1];
var v$819 = v$815[2];
return [0,[v$817,v$818,fix$1968.$replaceTy(tyvarseq$797,tyseq$800,v$819),[1]]];
 break; }default: {var v$820 = v$815[0];
var v$821 = v$815[1];
var v$822 = v$815[2];
var v$823 = v$816[1];
return [0,[v$820,v$821,fix$1968.$replaceTy(tyvarseq$797,tyseq$800,v$822),[0,fix$1968.$replaceTyrow(tyvarseq$797,tyseq$800,v$823)]]];
} };
};
var replaceTy$724 = fix$1968.$replaceTy;
var replaceTyrow$723 = fix$1968.$replaceTyrow;
var en$Lookup_tycon$824 = new String("Lookup_tycon");
var exn$Lookup_tycon$824 = [en$Lookup_tycon$824];
var fix$1969 = {};
fix$1969.$rewriteTy = function(ty$864){switch (ty$864[0]) { case 0: {return ty$864;
 break; }case 1: {var v$922 = ty$864[1];
var v$923 = v$922[1];
switch (v$923[0]) { case 1: {return ty$864;
 break; }default: {var v$925 = v$922[0];
var v$926 = v$923[1];
return [1,[v$925,[0,fix$1969.$rewriteTyrow(v$926)]]];
} };
 break; }case 4: {var v$917 = ty$864[1];
var v$918 = v$917[0];
var v$919 = v$917[1];
var v$920 = v$917[2];
var v$914 = syntax_objects$TyCon$.explode_LongTyCon$97(v$920);
var v$915 = v$914[0];
var v$916 = v$914[1];
var t$1986;
var v$1659 = null;
var fix$1987 = {};
fix$1987.$eq_list = function(v$1870,v$1871){lab$eq_list: while (true) {if (v$1870 == null) {return (v$1871 == null)?true:false;
} else {if (v$1871 == null) {return false;
} else {var v$1872 = v$1870;
var v$1873 = v$1871;
if (syntax_objects$StrId$.eq_strid$172(v$1872[0],v$1873[0])) {var t$1988 = v$1872[1];
var t$1989 = v$1873[1];
var v$1870 = t$1988;
var v$1871 = t$1989;
continue lab$eq_list;
} else {return false;
};
};
};
};
};
var eq_list$1869 = fix$1987.$eq_list;
t$1986 = (eq_list$1869(v$915,v$1659));
if (t$1986) {try {var v$908;
var fix$1990 = {};
fix$1990.$lookup_tycon = function(typbind$1727){lab$lookup_tycon: while (true) {var v$1728 = typbind$1727[1];
var v$1729 = v$1728[4];
switch (v$1729[0]) { case 1: {var v$1730 = v$1728[1];
var v$1731 = v$1728[2];
var v$1732 = v$1728[3];
if (syntax_objects$TyCon$.eq_tycon$215(v$1731,v$916)) {return [v$1730,v$1732];
} else {throw exn$Lookup_tycon$824;
};
 break; }default: {var v$1738 = v$1728[1];
var v$1739 = v$1728[2];
var v$1740 = v$1728[3];
var v$1741 = v$1729[1];
if (syntax_objects$TyCon$.eq_tycon$215(v$1739,v$916)) {return [v$1738,v$1740];
} else {var t$1991 = v$1741;
var typbind$1727 = t$1991;
continue lab$lookup_tycon;
};
} };
};
};
var lookup_tycon$1726 = fix$1990.$lookup_tycon;
v$908 = (lookup_tycon$1726(v$1047));
var v$909 = v$908[0];
var v$910 = v$908[1];
var t$1995;
var v$1660;
var fix$1992 = {};
fix$1992.$acc = function(v$1471,v$1472){lab$acc: while (true) {if (v$1471 == null) {return v$1472;
} else {var v$1473 = v$1471;
var v$1474 = v$1473[1];
var t$1993 = v$1474;
var t$1994 = SmlPrims.chk_ovf_i32(v$1472 + 1);
var v$1471 = t$1993;
var v$1472 = t$1994;
continue lab$acc;
};
};
};
var acc$1470 = fix$1992.$acc;
v$1660 = (acc$1470(v$919,0));
var v$1661;
var fix$1996 = {};
fix$1996.$acc = function(v$1477,v$1478){lab$acc: while (true) {if (v$1477 == null) {return v$1478;
} else {var v$1479 = v$1477;
var v$1480 = v$1479[1];
var t$1997 = v$1480;
var t$1998 = SmlPrims.chk_ovf_i32(v$1478 + 1);
var v$1477 = t$1997;
var v$1478 = t$1998;
continue lab$acc;
};
};
};
var acc$1476 = fix$1996.$acc;
v$1661 = (acc$1476(v$909,0));
t$1995 = ((v$1660 == v$1661)?false:true);
t$1995?(tools$Crash$.unimplemented$71("GrammarUtils.rewriteDatBind< insert error info into i >")):0;
return replaceTy$724(v$909,v$919,v$910);
} catch(v$1981) {return (function(Lookup_tycon$913){var t$1999 = Lookup_tycon$913;
if (t$1999[0] == en$Lookup_tycon$824) {var t$2003;
var t$2002 = v$918;
var t$2001;
var fix$2000 = {};
fix$2000.$map = function(v$1484){if (v$1484 == null) {return null;
} else {var v$1485 = v$1484;
var v$1486 = v$1485[0];
var v$1487 = v$1485[1];
return [fix$1969.$rewriteTy(v$1486),fix$2000.$map(v$1487)];
};
};
var map$1483 = fix$2000.$map;
t$2001 = (map$1483(v$919));
t$2003 = [t$2002,t$2001,v$920];
return [4,t$2003];
} else {throw Lookup_tycon$913;
};
})(v$1981);
};
} else {var t$1985;
var t$1984 = v$918;
var t$1983;
var fix$1982 = {};
fix$1982.$map = function(v$1491){if (v$1491 == null) {return null;
} else {var v$1492 = v$1491;
var v$1493 = v$1492[0];
var v$1494 = v$1492[1];
return [fix$1969.$rewriteTy(v$1493),fix$1982.$map(v$1494)];
};
};
var map$1490 = fix$1982.$map;
t$1983 = (map$1490(v$919));
t$1985 = [t$1984,t$1983,v$920];
return [4,t$1985];
};
 break; }case 3: {var v$889 = ty$864[1];
var v$890 = v$889[0];
var v$891 = v$889[1];
var v$892 = v$889[2];
return [3,[v$890,fix$1969.$rewriteTy(v$891),fix$1969.$rewriteTy(v$892)]];
 break; }default: {var v$928 = ty$864[1];
var v$929 = v$928[0];
var v$930 = v$928[1];
return [2,[v$929,fix$1969.$rewriteTy(v$930)]];
} };
};
fix$1969.$rewriteTyrow = function(tyrow$933){var v$945 = tyrow$933[1];
var v$946 = v$945[3];
switch (v$946[0]) { case 1: {var v$947 = v$945[0];
var v$948 = v$945[1];
var v$949 = v$945[2];
return [0,[v$947,v$948,fix$1969.$rewriteTy(v$949),[1]]];
 break; }default: {var v$950 = v$945[0];
var v$951 = v$945[1];
var v$952 = v$945[2];
var v$953 = v$946[1];
return [0,[v$950,v$951,fix$1969.$rewriteTy(v$952),[0,fix$1969.$rewriteTyrow(v$953)]]];
} };
};
var rewriteTy$861 = fix$1969.$rewriteTy;
var rewriteTyrow$860 = fix$1969.$rewriteTyrow;
var fix$1970 = {};
fix$1970.$rewriteConBind = function(v$957){var v$978 = v$957[1];
var v$979 = v$978[2];
switch (v$979[0]) { case 1: {var v$980 = v$978[3];
switch (v$980[0]) { case 1: {return [0,[v$978[0],v$978[1],[1],[1]]];
 break; }default: {var v$983 = v$978[0];
var v$984 = v$978[1];
var v$985 = v$980[1];
return [0,[v$983,v$984,[1],[0,fix$1970.$rewriteConBind(v$985)]]];
} };
 break; }default: {var v$986 = v$978[3];
switch (v$986[0]) { case 1: {var v$987 = v$978[0];
var v$988 = v$978[1];
var v$989 = v$979[1];
return [0,[v$987,v$988,[0,rewriteTy$861(v$989)],[1]]];
 break; }default: {var v$990 = v$978[0];
var v$991 = v$978[1];
var v$992 = v$979[1];
var v$993 = v$986[1];
return [0,[v$990,v$991,[0,rewriteTy$861(v$992)],[0,fix$1970.$rewriteConBind(v$993)]]];
} };
} };
};
var rewriteConBind$954 = fix$1970.$rewriteConBind;
var v$1031 = v$1046[1];
var v$1032 = v$1031[4];
switch (v$1032[0]) { case 1: {var v$1035 = v$1031[0];
var v$1036 = v$1031[1];
var v$1037 = v$1031[2];
var v$1038 = v$1031[3];
var t$1972;
try {var fix$1973 = {};
fix$1973.$lookup_tycon = function(typbind$1750){lab$lookup_tycon: while (true) {var v$1751 = typbind$1750[1];
var v$1752 = v$1751[4];
switch (v$1752[0]) { case 1: {var v$1753 = v$1751[1];
var v$1754 = v$1751[2];
var v$1755 = v$1751[3];
if (syntax_objects$TyCon$.eq_tycon$215(v$1754,v$1037)) {return [v$1753,v$1755];
} else {throw exn$Lookup_tycon$824;
};
 break; }default: {var v$1761 = v$1751[1];
var v$1762 = v$1751[2];
var v$1763 = v$1751[3];
var v$1764 = v$1752[1];
if (syntax_objects$TyCon$.eq_tycon$215(v$1762,v$1037)) {return [v$1761,v$1763];
} else {var t$1974 = v$1764;
var typbind$1750 = t$1974;
continue lab$lookup_tycon;
};
} };
};
};
var lookup_tycon$1749 = fix$1973.$lookup_tycon;
lookup_tycon$1749(v$1047);
t$1972 = true;
} catch(v$1971) {t$1972 = ((function(Lookup_tycon$1504){var t$1975 = Lookup_tycon$1504;
if (t$1975[0] == en$Lookup_tycon$824) {return false;
} else {throw Lookup_tycon$1504;
};
})(v$1971));
};
if (t$1972) {var pos$1505 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1035)))[0];
throw [basics$LexBasics$.en$LEXICAL_ERROR$623,[pos$1505,("type constructor " + (syntax_objects$TyCon$.pr_TyCon$53(v$1037))) + " is bound by both datatype binding and withtype binding"]];
} else {0;
};
return [0,[v$1035,v$1036,v$1037,rewriteConBind$954(v$1038),[1]]];
 break; }default: {var v$1041 = v$1031[0];
var v$1042 = v$1031[1];
var v$1043 = v$1031[2];
var v$1044 = v$1031[3];
var v$1045 = v$1032[1];
var t$1977;
try {var fix$1978 = {};
fix$1978.$lookup_tycon = function(typbind$1774){lab$lookup_tycon: while (true) {var v$1775 = typbind$1774[1];
var v$1776 = v$1775[4];
switch (v$1776[0]) { case 1: {var v$1777 = v$1775[1];
var v$1778 = v$1775[2];
var v$1779 = v$1775[3];
if (syntax_objects$TyCon$.eq_tycon$215(v$1778,v$1043)) {return [v$1777,v$1779];
} else {throw exn$Lookup_tycon$824;
};
 break; }default: {var v$1785 = v$1775[1];
var v$1786 = v$1775[2];
var v$1787 = v$1775[3];
var v$1788 = v$1776[1];
if (syntax_objects$TyCon$.eq_tycon$215(v$1786,v$1043)) {return [v$1785,v$1787];
} else {var t$1979 = v$1788;
var typbind$1774 = t$1979;
continue lab$lookup_tycon;
};
} };
};
};
var lookup_tycon$1773 = fix$1978.$lookup_tycon;
lookup_tycon$1773(v$1047);
t$1977 = true;
} catch(v$1976) {t$1977 = ((function(Lookup_tycon$1512){var t$1980 = Lookup_tycon$1512;
if (t$1980[0] == en$Lookup_tycon$824) {return false;
} else {throw Lookup_tycon$1512;
};
})(v$1976));
};
if (t$1977) {var pos$1513 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1041)))[0];
throw [basics$LexBasics$.en$LEXICAL_ERROR$623,[pos$1513,("type constructor " + (syntax_objects$TyCon$.pr_TyCon$53(v$1043))) + " is bound by both datatype binding and withtype binding"]];
} else {0;
};
return [0,[v$1041,v$1042,v$1043,rewriteConBind$954(v$1044),[0,fix$1947.$rewriteDatBind(v$1045,v$1047)]]];
} };
};
basics$GrammarUtils$.rewriteDatBind$718 = fix$1947.$rewriteDatBind;
basics$GrammarUtils$.tuple_atpat_with_info$1048 = function(info$1051,pats$1054){var fix$1948 = {};
fix$1948.$f = function(v$1859,v$1066){if (v$1066 == null) {return [1];
} else {var v$1069 = v$1066;
var v$1070 = v$1069[0];
var v$1071 = v$1069[1];
return [0,[0,[info$1051,syntax_objects$Lab$.mk_IntegerLab$104(v$1859),v$1070,fix$1948.$f(SmlPrims.chk_ovf_i32(v$1859 + 1),v$1071)]]];
};
};
var f$1055 = fix$1948.$f;
return [2,[info$1051,f$1055(1,pats$1054)]];
};
basics$GrammarUtils$.tuple_atpat$1072 = function(v$1075){if (v$1075 == null) {return tools$Crash$.impossible$50("GrammarUtils.tuple_atpat");
} else {var v$1085 = v$1075;
var v$1086 = v$1085[1];
if (v$1086 == null) {return tools$Crash$.impossible$50("GrammarUtils.tuple_atpat");
} else {var v$1090 = v$1085[0];
var v$1091 = v$1086;
var v$1092 = v$1091[0];
var v$1093 = v$1091[1];
var info$1518;
var v$1670 = basics$PreElabDecGrammar$$2.get_info_pat$211(v$1090);
var v$1671;
try {v$1671 = (basics$PreElabDecGrammar$$2.get_info_pat$211(basis$List$.last$81([v$1092,v$1093])));
} catch(v$1949) {v$1671 = ((function(v$1089){return tools$Crash$.impossible$50("GrammarUtils.tuple_atpat: last");
})(v$1949));
};
var pos_l$1530 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1670)))[0];
var pos_r$1531 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1671)))[1];
info$1518 = (basics$ParseInfo$.from_SourceInfo$58(basics$SourceInfo$.from_positions$51(pos_l$1530,pos_r$1531)));
var pats$1519 = [v$1090,[v$1092,v$1093]];
var fix$1950 = {};
fix$1950.$f = function(v$1860,v$1522){if (v$1522 == null) {return [1];
} else {var v$1524 = v$1522;
var v$1525 = v$1524[0];
var v$1526 = v$1524[1];
return [0,[0,[info$1518,syntax_objects$Lab$.mk_IntegerLab$104(v$1860),v$1525,fix$1950.$f(SmlPrims.chk_ovf_i32(v$1860 + 1),v$1526)]]];
};
};
var f$1520 = fix$1950.$f;
return [2,[info$1518,f$1520(1,pats$1519)]];
};
};
};
basics$GrammarUtils$.list_atpat$1095 = function(info$1098,pats$1101){var fix$1951 = {};
fix$1951.$f = function(v$1105){if (v$1105 == null) {var atpat$1544 = [4,[info$1098,[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_NIL$130),false]]]];
return [4,[basics$PreElabDecGrammar$$2.get_info_atpat$210(atpat$1544),atpat$1544]];
} else {var v$1113 = v$1105;
var v$1114 = v$1113[0];
var v$1115 = v$1113[1];
return [3,[basics$PreElabDecGrammar$$2.get_info_pat$211(v$1114),[0,[syntax_objects$Ident$.idToLongId$201(syntax_objects$Ident$.id_CONS$131),false]],basics$GrammarUtils$.tuple_atpat$1072([v$1114,[fix$1951.$f(v$1115),null]])]];
};
};
var f$1102 = fix$1951.$f;
return [3,[info$1098,f$1102(pats$1101)]];
};
basics$GrammarUtils$.en$LAYERPAT_ERROR$1116 = new String("LAYERPAT_ERROR");
basics$GrammarUtils$.layeredPat$1117 = function(v$1173,v$1174,v$1175){switch (v$1174[0]) { case 1: {var v$1161 = v$1174[1];
var v$1162 = v$1161[1];
switch (v$1162[0]) { case 4: {var v$1164 = v$1162[1];
var v$1165 = v$1164[1];
switch (v$1165[0]) { case 4: {var v$1167 = v$1165[1];
var v$1168 = v$1167[1];
var v$1169 = v$1168[1];
var v$1170 = v$1169[0];
var v$1171 = v$1169[1];
var v$1172 = v$1161[2];
var t$1961;
var t$1960 = v$1173;
var t$1959;
var t$1958;
var t$1957;
var v$1546 = syntax_objects$Ident$.decompose$87(v$1170);
if (v$1546[0] == null) {t$1957 = v$1546[1];
} else {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
};
t$1958 = [t$1957,v$1171];
t$1959 = [0,t$1958];
t$1961 = [t$1960,t$1959,[0,v$1172],v$1175];
return [2,t$1961];
 break; }default: {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
} };
 break; }default: {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
} };
 break; }case 4: {var v$1151 = v$1174[1];
var v$1152 = v$1151[1];
switch (v$1152[0]) { case 4: {var v$1154 = v$1152[1];
var v$1155 = v$1154[1];
var v$1156 = v$1155[1];
var v$1157 = v$1156[0];
var v$1158 = v$1156[1];
var t$1956;
var t$1955 = v$1173;
var t$1954;
var t$1953;
var t$1952;
var v$1550 = syntax_objects$Ident$.decompose$87(v$1157);
if (v$1550[0] == null) {t$1952 = v$1550[1];
} else {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
};
t$1953 = [t$1952,v$1158];
t$1954 = [0,t$1953];
t$1956 = [t$1955,t$1954,[1],v$1175];
return [2,t$1956];
 break; }default: {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
} };
 break; }default: {throw [basics$GrammarUtils$.en$LAYERPAT_ERROR$1116,basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1173))];
} };
};
basics$GrammarUtils$.tuple_type$1176 = function(info$1179,tys$1182){var fix$1962 = {};
fix$1962.$f = function(v$1861,v$1194){if (v$1194 == null) {return [1];
} else {var v$1197 = v$1194;
var v$1198 = v$1197[0];
var v$1199 = v$1197[1];
return [0,[0,[info$1179,syntax_objects$Lab$.mk_IntegerLab$104(v$1861),v$1198,fix$1962.$f(SmlPrims.chk_ovf_i32(v$1861 + 1),v$1199)]]];
};
};
var f$1183 = fix$1962.$f;
return [1,[info$1179,f$1183(1,tys$1182)]];
};
basics$GrammarUtils$.rewrite_type_abbreviation_spec$1200 = function(v$1208,v$1209,v$1210,v$1211,v$1212){return [v$1211,[6,[v$1211,[0,[v$1211,[1,[v$1212,[1,[v$1212,[0,[v$1212,v$1208,v$1209,[1]]]]]]],v$1208,syntax_objects$TyCon$.implode_LongTyCon$90(null,v$1209),v$1210]]]]];
};
basics$GrammarUtils$.fold_specs_to_spec$1234 = function(i_spec_s$1237){var v$1242;
if (i_spec_s$1237 == null) {v$1242 = [1];
} else {var v$1567 = i_spec_s$1237;
var v$1568 = v$1567[0];
var v$1569 = v$1567[1];
var t$1967;
var fix$1963 = {};
fix$1963.$foldl = function(v$1574,v$1575){lab$foldl: while (true) {if (v$1575 == null) {return v$1574;
} else {var v$1576 = v$1575;
var v$1577 = v$1576[0];
var v$1578 = v$1576[1];
var t$1964;
var v$1834 = v$1577[0];
var v$1835 = v$1577[1];
var v$1837 = v$1574[0];
var v$1838 = v$1574[1];
var i12$1839;
var pos_l$1840 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1837)))[0];
var pos_r$1841 = (basics$SourceInfo$.to_positions$58(basics$ParseInfo$.to_SourceInfo$84(v$1834)))[1];
i12$1839 = (basics$ParseInfo$.from_SourceInfo$58(basics$SourceInfo$.from_positions$51(pos_l$1840,pos_r$1841)));
t$1964 = [i12$1839,[5,[i12$1839,v$1838,v$1835]]];
var t$1965 = t$1964;
var t$1966 = v$1578;
var v$1574 = t$1965;
var v$1575 = t$1966;
continue lab$foldl;
};
};
};
var foldl$1573 = fix$1963.$foldl;
t$1967 = (foldl$1573(v$1568,v$1569));
v$1242 = [0,t$1967];
};
switch (v$1242[0]) { case 0: {return v$1242[1][1];
 break; }default: {return tools$Crash$.impossible$50("GrammarUtils.fold_specs_to_spec");
} };
};
basics$GrammarUtils$.raise_lexical_error_if_none$1262 = function(v$1265,v$1268){switch (v$1268[0]) { case 1: {throw [basics$LexBasics$.en$LEXICAL_ERROR$623,[v$1265,"constant too big"]];
 break; }default: {return v$1268[1];
} };
};
basics$GrammarUtils$.reportPosition_from_info$1280 = function(x$1589){return basics$SourceInfo$.report$69(basics$ParseInfo$.to_SourceInfo$84(x$1589));
};
return 0;
})();
