if ((typeof(basics$LexBasics$)) == "undefined") {basics$LexBasics$ = {};
};
(function(){basics$LexBasics$.eq_SourceText$650 = function(v$652,v$653){switch (v$653[0]) { case 0: {var v$654 = v$652[1];
var v$655 = v$653[1];
if (v$654[0] == v$655[0]) {var fix$1093 = {};
fix$1093.$eq_list = function(v$667,v$668){lab$eq_list: while (true) {if (v$667 == null) {return (v$668 == null)?true:false;
} else {if (v$668 == null) {return false;
} else {var v$669 = v$667;
var v$670 = v$668;
var t$1094;
var v$927 = v$669[0];
var v$928 = v$670[0];
t$1094 = ((v$927[0] == v$928[0])?(v$927[1] == v$928[1]):false);
if (t$1094) {var t$1095 = v$669[1];
var t$1096 = v$670[1];
var v$667 = t$1095;
var v$668 = t$1096;
continue lab$eq_list;
} else {return false;
};
};
};
};
};
var eq_list$665 = fix$1093.$eq_list;
return eq_list$665(v$654[1],v$655[1]);
} else {return false;
};
 break; }default: {return false;
} };
};
var fix$1097 = {};
fix$1097.$spaces = function(v$67,v$68){lab$spaces: while (true) {if (v$67 <= 0) {return v$68;
} else {var t$1098 = SmlPrims.chk_ovf_i32(v$67 - 1);
var t$1099 = [32,v$68];
var v$67 = t$1098;
var v$68 = t$1099;
continue lab$spaces;
};
};
};
var spaces$58 = fix$1097.$spaces;
var fix$1100 = {};
fix$1100.$untabifyL = function(v$1051,v$84){lab$untabifyL: while (true) {if (v$84 == null) {return null;
} else {var v$86 = v$84;
var v$87 = v$86[0];
switch (v$87) { case 9: {var v$90 = v$86[1];
var gap$88 = SmlPrims.chk_ovf_i32(8 - (SmlPrims.mod_i32(v$1051,8,CompilerInitial.exn$Div$40)));
return spaces$58(gap$88,fix$1100.$untabifyL(SmlPrims.chk_ovf_i32(v$1051 + gap$88),v$90));
 break; }default: {var v$92 = v$86[1];
return [v$87,fix$1100.$untabifyL(SmlPrims.chk_ovf_i32(v$1051 + 1),v$92)];
} };
};
};
};
var untabifyL$69 = fix$1100.$untabifyL;
var fix$1101 = {};
fix$1101.$withAbsCharacter = function(v$1052,v$111){if (v$111 == null) {return null;
} else {var v$114 = v$111;
var v$115 = v$114[0];
var v$116 = v$114[1];
return [[v$1052,v$115],fix$1101.$withAbsCharacter(SmlPrims.chk_ovf_i32(v$1052 + v$115.length),v$116)];
};
};
var withAbsCharacter$100 = fix$1101.$withAbsCharacter;
var sourceReader$117 = function(getc$120,cs$123){var fix$1102 = {};
fix$1102.$loop = function(v$144,v$145,v$146){lab$loop: while (true) {var v$138 = getc$120(v$144);
switch (v$138[0]) { case 0: {var v$140 = v$138[1];
var v$141 = v$140[0];
switch (v$141) { case 10: {var v$142 = v$140[1];
var t$1103 = v$142;
var t$1104 = null;
var t$1105 = [SmlPrims.implode(basis$List$.rev$641([10,v$145])),v$146];
var v$144 = t$1103;
var v$145 = t$1104;
var v$146 = t$1105;
continue lab$loop;
 break; }default: {var v$143 = v$140[1];
var t$1106 = v$143;
var t$1107 = [v$141,v$145];
var t$1108 = v$146;
var v$144 = t$1106;
var v$145 = t$1107;
var v$146 = t$1108;
continue lab$loop;
} };
 break; }default: {return [0,[basis$List$.rev$641([SmlPrims.implode(basis$List$.rev$641(v$145)),v$146]),v$144]];
} };
};
};
var loop$124 = fix$1102.$loop;
return loop$124(cs$123,null,null);
};
var lexFromSourceText$289 = function(source$292){var v$323 = source$292[1];
var v$324 = v$323[0];
var v$325 = v$323[1];
var theLines$298 = [v$325];
return [0,[function(v$731){return 0;
},function(v$732){var v$733 = theLines$298[0];
if (v$733 == null) {return "";
} else {var v$734 = v$733;
var v$735 = v$734[0];
var v$736 = v$735[1];
var v$737 = v$734[1];
(theLines$298[0] = v$737,0);
return v$736;
};
},v$324,function(absPos$318){var v$935 = [source$292];
return function(v$742){var v$743 = v$935[0][1];
var v$744 = v$743[0];
var v$745 = v$743[1];
var fix$1109 = {};
fix$1109.$search = function(v$1053,v$1054,v$748){if (v$748 == null) {switch (v$1054[0]) { case 0: {return [SmlPrims.chk_ovf_i32(absPos$318 - v$1054[1][0]),v$744,function(n$760){var v$761 = v$935[0][1];
var v$762 = v$761[1];
return (basis$List$.nth$98(v$762,SmlPrims.chk_ovf_i32(n$760 - 1)))[1];
},v$1053];
 break; }default: {return tools$Crash$.impossible$50("LexBasics.search(previous/2)");
} };
} else {var v$751 = v$748;
var v$752 = v$751[0];
var v$753 = v$752[0];
var v$754 = v$751[1];
if (absPos$318 < v$753) {switch (v$1054[0]) { case 0: {return [SmlPrims.chk_ovf_i32(absPos$318 - v$1054[1][0]),v$744,function(n$755){var v$756 = v$935[0][1];
var v$757 = v$756[1];
return (basis$List$.nth$98(v$757,SmlPrims.chk_ovf_i32(n$755 - 1)))[1];
},v$1053];
 break; }default: {return tools$Crash$.impossible$50("LexBasics.search(previous/1)");
} };
} else {return fix$1109.$search(SmlPrims.chk_ovf_i32(v$1053 + 1),[0,v$752],v$754);
};
};
};
var search$746 = fix$1109.$search;
return search$746(0,[1],v$745);
};
}]];
};
basics$LexBasics$.lexFromString$326 = function(x$766){var t$1121 = lexFromSourceText$289;
var t$1110;
var lines$1011;
var l$1012;
var v$1013 = basis$StringCvt$.scanString$154(function(v$1059){return function(v$1060){return sourceReader$117(v$1059,v$1060);
};
},x$766);
switch (v$1013[0]) { case 0: {l$1012 = v$1013[1];
 break; }default: {l$1012 = ["",null];
} };
var fix$1111 = {};
fix$1111.$map = function(v$1015){if (v$1015 == null) {return null;
} else {var v$1016 = v$1015;
var v$1017 = v$1016[0];
var v$1018 = v$1016[1];
var t$1120;
var t$1119;
var t$1118;
var t$1117 = untabifyL$69;
var t$1116 = 0;
var t$1115;
var fix$1112 = {};
fix$1112.$h = function(v$1021,v$1022){lab$h: while (true) {if (v$1021 < 0) {return v$1022;
} else {var t$1113 = SmlPrims.chk_ovf_i32(v$1021 - 1);
var t$1114 = [v$1017.charCodeAt(v$1021),v$1022];
var v$1021 = t$1113;
var v$1022 = t$1114;
continue lab$h;
};
};
};
var h$1019 = fix$1112.$h;
t$1115 = (h$1019(SmlPrims.chk_ovf_i32(v$1017.length - 1),null));
t$1118 = (t$1117(t$1116,t$1115));
t$1119 = (SmlPrims.implode(t$1118));
t$1120 = [t$1119,fix$1111.$map(v$1018)];
return t$1120;
};
};
var map$1014 = fix$1111.$map;
lines$1011 = (map$1014(l$1012));
t$1110 = [0,["<string>",withAbsCharacter$100(0,lines$1011)]];
return t$1121(t$1110);
};
basics$LexBasics$.lexFromFile$330 = function(x$794){var t$1133 = lexFromSourceText$289;
var t$1122;
var stream$1038 = basis$TextIO$.openIn$160(x$794);
var lines$1039;
var l$1040;
var v$1041 = basis$TextIO$.scanStream$187(function(v$1061){return function(v$1062){return sourceReader$117(v$1061,v$1062);
};
},stream$1038);
switch (v$1041[0]) { case 0: {l$1040 = v$1041[1];
 break; }default: {l$1040 = ["",null];
} };
var fix$1123 = {};
fix$1123.$map = function(v$1043){if (v$1043 == null) {return null;
} else {var v$1044 = v$1043;
var v$1045 = v$1044[0];
var v$1046 = v$1044[1];
var t$1132;
var t$1131;
var t$1130;
var t$1129 = untabifyL$69;
var t$1128 = 0;
var t$1127;
var fix$1124 = {};
fix$1124.$h = function(v$1049,v$1050){lab$h: while (true) {if (v$1049 < 0) {return v$1050;
} else {var t$1125 = SmlPrims.chk_ovf_i32(v$1049 - 1);
var t$1126 = [v$1045.charCodeAt(v$1049),v$1050];
var v$1049 = t$1125;
var v$1050 = t$1126;
continue lab$h;
};
};
};
var h$1047 = fix$1124.$h;
t$1127 = (h$1047(SmlPrims.chk_ovf_i32(v$1045.length - 1),null));
t$1130 = (t$1129(t$1128,t$1127));
t$1131 = (SmlPrims.implode(t$1130));
t$1132 = [t$1131,fix$1123.$map(v$1046)];
return t$1132;
};
};
var map$1042 = fix$1123.$map;
lines$1039 = (map$1042(l$1040));
basis$TextIO$.closeIn$163(stream$1038);
t$1122 = [0,[x$794,withAbsCharacter$100(0,lines$1039)]];
return t$1133(t$1122);
};
var highlight$332 = function(v$363,v$364,v$365){try {var fix$1135 = {};
fix$1135.$drop_nl = function(v$341){lab$drop_nl: while (true) {if (v$341 == null) {return null;
} else {var v$351 = v$341;
var v$352 = v$351[0];
switch (v$352) { case 10: {var v$353 = v$351[1];
var t$1136 = v$353;
var v$341 = t$1136;
continue lab$drop_nl;
 break; }default: {var v$354 = v$351[1];
return [v$352,fix$1135.$drop_nl(v$354)];
} };
};
};
};
var drop_nl$338 = fix$1135.$drop_nl;
var line$355;
var t$1142;
var t$1141 = drop_nl$338;
var t$1140;
var fix$1137 = {};
fix$1137.$h = function(v$822,v$823){lab$h: while (true) {if (v$822 < 0) {return v$823;
} else {var t$1138 = SmlPrims.chk_ovf_i32(v$822 - 1);
var t$1139 = [v$363.charCodeAt(v$822),v$823];
var v$822 = t$1138;
var v$823 = t$1139;
continue lab$h;
};
};
};
var h$820 = fix$1137.$h;
t$1140 = (h$820(SmlPrims.chk_ovf_i32(v$363.length - 1),null));
t$1142 = (t$1141(t$1140));
line$355 = (SmlPrims.implode(t$1142));
var width$356 = (v$365 <= 0)?1:v$365;
var t$1154 = tools$Report$.indent$79;
var t$1153 = ". ".length;
var t$1152;
var t$1151 = tools$Report$.s$hh$55;
var t$1150 = tools$Report$.line$51(line$355);
var t$1149;
var t$1148 = tools$Report$.line$51;
var t$1147;
var t$1145;
var ssize$829 = "".length;
var fix$1146 = {};
fix$1146.$f = function(v$831){switch (v$831) { case 0: {return null;
 break; }default: {return [32,fix$1146.$f(SmlPrims.chk_ovf_i32(v$831 - 1))];
} };
};
var f$830 = fix$1146.$f;
t$1145 = ((v$364 <= ssize$829)?"":(SmlPrims.concat([SmlPrims.implode(f$830(SmlPrims.chk_ovf_i32(v$364 - ssize$829))),["",null]])));
var t$1143;
var ssize$835 = "".length;
var fix$1144 = {};
fix$1144.$f = function(v$837){switch (v$837) { case 0: {return null;
 break; }default: {return [94,fix$1144.$f(SmlPrims.chk_ovf_i32(v$837 - 1))];
} };
};
var f$836 = fix$1144.$f;
t$1143 = ((width$356 <= ssize$835)?"":(SmlPrims.concat(["",[SmlPrims.implode(f$836(SmlPrims.chk_ovf_i32(width$356 - ssize$835))),null]])));
t$1147 = (t$1145 + t$1143);
t$1149 = (t$1148(t$1147));
t$1152 = (t$1151(t$1150,t$1149));
return t$1154(t$1153,t$1152);
} catch(v$1134) {return (function(v$362){return tools$Crash$.impossible$50("LexBasics.highlight: width or column <0");
})(v$1134);
};
};
basics$LexBasics$.layoutPos$366 = function(v$369){if (v$369 == null) {return [1,"DUMMY"];
} else {var v$391 = v$369;
var v$386 = v$391(0);
var v$387 = v$386[1];
var v$388 = v$386[3];
var v$389 = v$386[0];
var v$390 = v$386[2];
var t$1155;
var v$384 = [0,","];
t$1155 = [[[1,("\"" + v$387) + "\""],[[1,"line " + (basis$Int32$.toString$449(v$388))],[[1,"column " + (basis$Int32$.toString$449(v$389))],[[1,("\"" + (v$390(v$388))) + "\""],null]]]],v$384,")",3,"POSITION("];
return [0,t$1155];
};
};
basics$LexBasics$.reportPosition$392 = function(v$405,v$1055){if (v$405 == null) {return tools$Report$.s$hh$55(tools$Report$.s$hh$55(tools$Report$.line$51("(position unknown (*4*)): "),tools$PrettyPrint$.reportStringTree$1097(basics$LexBasics$.layoutPos$366(v$405))),tools$PrettyPrint$.reportStringTree$1097(basics$LexBasics$.layoutPos$366(v$1055)));
} else {if (v$1055 == null) {return tools$Report$.s$hh$55(tools$Report$.s$hh$55(tools$Report$.line$51("(position unknown (*4*)): "),tools$PrettyPrint$.reportStringTree$1097(basics$LexBasics$.layoutPos$366(v$405))),tools$PrettyPrint$.reportStringTree$1097(basics$LexBasics$.layoutPos$366(v$1055)));
} else {var v$452 = v$405;
var v$453 = v$1055;
var v$447 = v$452(0);
var v$448 = v$447[1];
var v$449 = v$447[3];
var v$450 = v$447[0];
var v$451 = v$447[2];
var v$444 = v$453(0);
var v$445 = v$444[3];
var v$446 = v$444[0];
var theLine1$417 = v$451(v$449);
var theLine2$418 = v$451(v$445);
var len1$419 = SmlPrims.chk_ovf_i32(theLine1$417.length - 1);
SmlPrims.chk_ovf_i32(theLine2$418.length - 1);
var fix$1156 = {};
fix$1156.$highlightAll = function(v$432,v$433){lab$highlightAll: while (true) {if (v$432 > v$433) {return tools$Report$.null$50;
} else {var line$430 = v$451(v$432);
var width$431 = SmlPrims.chk_ovf_i32(line$430.length - 1);
return tools$Report$.s$hh$55(highlight$332(line$430,0,width$431),fix$1156.$highlightAll(SmlPrims.chk_ovf_i32(v$432 + 1),v$433));
};
};
};
var highlightAll$421 = fix$1156.$highlightAll;
var t$1164 = tools$Report$.s$hh$55;
var t$1163 = tools$Report$.line$51(((((v$448 + ", line ") + (basis$Int32$.toString$449(v$449))) + ", column ") + (basis$Int32$.toString$449(v$450))) + ":");
var t$1162;
if (v$449 == v$445) {t$1162 = (highlight$332(theLine1$417,v$450,SmlPrims.chk_ovf_i32(v$446 - v$450)));
} else {var t$1161 = tools$Report$.s$hh$55;
var t$1160;
var t$1159 = tools$Report$.s$hh$55;
var t$1158 = highlight$332(theLine1$417,v$450,SmlPrims.chk_ovf_i32(len1$419 - v$450));
var t$1157;
var lower$438 = SmlPrims.chk_ovf_i32(v$449 + 1);
var upper$439 = SmlPrims.chk_ovf_i32(v$445 - 1);
t$1157 = (((SmlPrims.chk_ovf_i32(upper$439 - lower$438)) > 5)?(tools$Report$.line$51("      (text omitted)")):(highlightAll$421(lower$438,upper$439)));
t$1160 = (t$1159(t$1158,t$1157));
t$1162 = (t$1161(t$1160,highlight$332(theLine2$418,0,v$446)));
};
return t$1164(t$1163,t$1162);
};
};
};
basics$LexBasics$.output_source$457 = function(v$470,v$1056,v$1057){if (v$470 == null) {return basis$TextIO$.output$101(v$1056,"*** POSITION UNKNOWN ***");
} else {if (v$1057 == null) {return basis$TextIO$.output$101(v$1056,"*** POSITION UNKNOWN ***");
} else {var v$540 = v$470;
var v$541 = v$1057;
var v$534 = v$540(0);
var v$536 = v$534[3];
var v$537 = v$534[0];
var v$538 = v$534[2];
var v$531 = v$541(0);
var v$532 = v$531[3];
var v$533 = v$531[0];
if (v$536 == v$532) {var line$512 = v$538(v$536);
var t$1171 = basis$TextIO$.output$101;
var t$1170 = v$1056;
var t$1165;
var s$1063;
var v$1077 = [0,SmlPrims.chk_ovf_i32(v$533 - v$537)];
try {s$1063 = (basis$String$.extract$107(line$512,v$537,v$1077));
} catch(v$1166) {s$1063 = ((function(e$868){basis$General$.print$156("extract : line\n");
throw e$868;
})(v$1166));
};
var v$1064;
var fix$1167 = {};
fix$1167.$h = function(v$1066,v$1067){lab$h: while (true) {if (v$1066 < 0) {return v$1067;
} else {var t$1168 = SmlPrims.chk_ovf_i32(v$1066 - 1);
var t$1169 = [s$1063.charCodeAt(v$1066),v$1067];
var v$1066 = t$1168;
var v$1067 = t$1169;
continue lab$h;
};
};
};
var h$1065 = fix$1167.$h;
v$1064 = (h$1065(SmlPrims.chk_ovf_i32(s$1063.length - 1),null));
if (v$1064 == null) {t$1165 = (tools$Crash$.impossible$50("LexBasics.output_source"));
} else {var v$1068 = v$1064;
switch (v$1068[0]) { case 58: {t$1165 = s$1063;
 break; }case 61: {t$1165 = s$1063;
 break; }default: {t$1165 = (" = " + s$1063);
} };
};
return t$1171(t$1170,t$1165);
} else {var first$513 = v$538(v$536);
var first$514;
var s$1069;
var v$1080 = [1];
try {s$1069 = (basis$String$.extract$107(first$513,v$537,v$1080));
} catch(v$1172) {s$1069 = ((function(e$873){basis$General$.print$156("extract : first\n");
throw e$873;
})(v$1172));
};
var v$1070;
var fix$1173 = {};
fix$1173.$h = function(v$1072,v$1073){lab$h: while (true) {if (v$1072 < 0) {return v$1073;
} else {var t$1174 = SmlPrims.chk_ovf_i32(v$1072 - 1);
var t$1175 = [s$1069.charCodeAt(v$1072),v$1073];
var v$1072 = t$1174;
var v$1073 = t$1175;
continue lab$h;
};
};
};
var h$1071 = fix$1173.$h;
v$1070 = (h$1071(SmlPrims.chk_ovf_i32(s$1069.length - 1),null));
if (v$1070 == null) {first$514 = (tools$Crash$.impossible$50("LexBasics.output_source"));
} else {var v$1074 = v$1070;
switch (v$1074[0]) { case 58: {first$514 = s$1069;
 break; }case 61: {first$514 = s$1069;
 break; }default: {first$514 = (" = " + s$1069);
} };
};
var last$515 = v$538(v$532);
var last$516;
var v$1083 = [0,v$533];
try {last$516 = (basis$String$.extract$107(last$515,0,v$1083));
} catch(v$1176) {last$516 = ((function(e$878){basis$General$.print$156("extract : last\n");
throw e$878;
})(v$1176));
};
var fix$1177 = {};
fix$1177.$get_lines = function(v$526,v$527){lab$get_lines: while (true) {if (v$526 == v$536) {return [first$514,v$527];
} else {var t$1178 = SmlPrims.chk_ovf_i32(v$526 - 1);
var t$1179 = [v$538(v$526),v$527];
var v$526 = t$1178;
var v$527 = t$1179;
continue lab$get_lines;
};
};
};
var get_lines$517 = fix$1177.$get_lines;
var fix$1180 = {};
fix$1180.$app = function(v$885){lab$app: while (true) {if (v$885 == null) {return 0;
} else {var v$886 = v$885;
var v$887 = v$886[0];
var v$888 = v$886[1];
basis$TextIO$.output$101(v$1056,v$887);
var t$1181 = v$888;
var v$885 = t$1181;
continue lab$app;
};
};
};
var app$884 = fix$1180.$app;
return app$884(get_lines$517(SmlPrims.chk_ovf_i32(v$532 - 1),[last$516,null]));
};
};
};
};
basics$LexBasics$.get_source$544 = function(v$555,v$1058){if (v$555 == null) {return tools$Crash$.impossible$50("LexBasics.get_source: POSITION UNKNOWN");
} else {if (v$1058 == null) {return tools$Crash$.impossible$50("LexBasics.get_source: POSITION UNKNOWN");
} else {var v$619 = v$555;
var v$620 = v$1058;
var v$614 = v$619(0);
var v$616 = v$614[3];
var v$617 = v$614[0];
var v$618 = v$614[2];
var v$611 = v$620(0);
var v$612 = v$611[3];
var v$613 = v$611[0];
if (v$616 == v$612) {var line$595 = v$618(v$616);
var s$897;
var v$1086 = [0,SmlPrims.chk_ovf_i32(v$613 - v$617)];
try {s$897 = (basis$String$.extract$107(line$595,v$617,v$1086));
} catch(v$1182) {s$897 = ((function(e$902){basis$General$.print$156("extract : line\n");
throw e$902;
})(v$1182));
};
try {switch (basis$String$.sub$92(s$897,0)) { case 58: {return s$897;
 break; }case 61: {return s$897;
 break; }default: {return " = " + s$897;
} };
} catch(v$1183) {return (function(v$899){return tools$Crash$.impossible$50("LexBasics.get_source");
})(v$1183);
};
} else {var first$596 = v$618(v$616);
var first$597;
var s$905;
var v$1089 = [1];
try {s$905 = (basis$String$.extract$107(first$596,v$617,v$1089));
} catch(v$1184) {s$905 = ((function(e$910){basis$General$.print$156("extract : first\n");
throw e$910;
})(v$1184));
};
try {switch (basis$String$.sub$92(s$905,0)) { case 58: {first$597 = s$905;
 break; }case 61: {first$597 = s$905;
 break; }default: {first$597 = (" = " + s$905);
} };
} catch(v$1185) {first$597 = ((function(v$907){return tools$Crash$.impossible$50("LexBasics.get_source");
})(v$1185));
};
var last$598 = v$618(v$612);
var last$599;
var v$1092 = [0,v$613];
try {last$599 = (basis$String$.extract$107(last$598,0,v$1092));
} catch(v$1186) {last$599 = ((function(e$915){basis$General$.print$156("extract : last\n");
throw e$915;
})(v$1186));
};
var fix$1187 = {};
fix$1187.$get_lines = function(v$609,v$610){lab$get_lines: while (true) {if (v$609 == v$616) {return [first$597,v$610];
} else {var t$1188 = SmlPrims.chk_ovf_i32(v$609 - 1);
var t$1189 = [v$618(v$609),v$610];
var v$609 = t$1188;
var v$610 = t$1189;
continue lab$get_lines;
};
};
};
var get_lines$600 = fix$1187.$get_lines;
return SmlPrims.concat(get_lines$600(SmlPrims.chk_ovf_i32(v$612 - 1),[last$599,null]));
};
};
};
};
basics$LexBasics$.en$LEXICAL_ERROR$623 = new String("LEXICAL_ERROR");
return 0;
})();
