if ((typeof(tools$Timing$)) == "undefined") {tools$Timing$ = {};
};
(function(){var compiler_timings$72 = [false];
tools$Flags$$6.add_bool_entry$4699(["Show compiler timings for each compilation phase.",compiler_timings$72,"compiler_timings",["Debug",["compiler timings",null]],false,[0,"timings"]]);
var t$79 = [basis$Timer$.startCPUTimer$79(0)];
var rt$80 = [SmlPrims.getrealtime()];
var timingNow$81 = [false];
var timer_nesting$82 = [0];
var timings$83 = [null];
tools$Timing$.timing_begin$102 = function(v$104){if (compiler_timings$72[0]) {if (timingNow$81[0]) {return (timer_nesting$82[0] = (SmlPrims.chk_ovf_i32(timer_nesting$82[0] + 1)),0);
} else {(t$79[0] = (basis$Timer$.startCPUTimer$79(0)),0);
(timingNow$81[0] = true,0);
return (rt$80[0] = (SmlPrims.getrealtime()),0);
};
} else {return 0;
};
};
var fix$627 = {};
fix$627.$insert_time_elem = function(v$152,v$155){if (v$152 == null) {return [v$155,null];
} else {var v$172 = v$152;
var v$173 = v$172[0];
var v$174 = v$173[1];
var v$175 = v$172[1];
var v$177 = v$155[1];
if (v$174 == v$177) {var t$652;
var t$642;
var v$393 = v$173[1];
var v$394 = v$173[2];
var v$395 = v$173[3];
var v$396 = v$173[0];
var v$397 = v$173[4];
var v$399 = v$155[1];
var v$400 = v$155[2];
var v$401 = v$155[3];
var v$402 = v$155[0];
var v$403 = v$155[4];
if ((v$393 == v$399)?false:true) {t$642 = (tools$Crash$.impossible$50("Timing.Can only add timeelements with same name."));
} else {var v$411;
try {v$411 = (basis$Time$.s$f$288(v$394,v$400));
} catch(v$643) {v$411 = ((function(E$599){basis$General$.print$156(("Function Time_plus raises exception " + E$599[0]) + "\n");
throw E$599;
})(v$643));
};
var v$412;
try {v$412 = (basis$Time$.s$f$288(v$395,v$401));
} catch(v$644) {v$412 = ((function(E$603){basis$General$.print$156(("Function Time_plus raises exception " + E$603[0]) + "\n");
throw E$603;
})(v$644));
};
var t$651;
try {t$651 = (basis$Time$.s$f$288(v$396,v$402));
} catch(v$650) {t$651 = ((function(E$607){basis$General$.print$156(("Function Time_plus raises exception " + E$607[0]) + "\n");
throw E$607;
})(v$650));
};
var t$649 = v$393;
var t$648 = v$411;
var t$647 = v$412;
var t$646;
try {t$646 = (basis$Time$.s$f$288(v$397,v$403));
} catch(v$645) {t$646 = ((function(E$611){basis$General$.print$156(("Function Time_plus raises exception " + E$611[0]) + "\n");
throw E$611;
})(v$645));
};
t$642 = [t$651,t$649,t$648,t$647,t$646];
};
t$652 = [t$642,v$175];
return t$652;
} else {return [v$173,fix$627.$insert_time_elem(v$175,v$155)];
};
};
};
var insert_time_elem$149 = fix$627.$insert_time_elem;
tools$Timing$.timing_end$209 = function(name$212){if (compiler_timings$72[0]?true:timingNow$81[0]) {try {if (timingNow$81[0]?false:true) {return tools$Crash$.impossible$50("Timing.timing_end called with no timer started");
} else {if (timer_nesting$82[0] > 0) {return (timer_nesting$82[0] = (SmlPrims.chk_ovf_i32(timer_nesting$82[0] - 1)),0);
} else {(timingNow$81[0] = false,0);
var v$251;
var v$624 = t$79[0];
v$251 = (basis$Timer$.checkCPUTimer$82(v$624[0],v$624[1],v$624[2]));
var v$252 = v$251[0];
var v$253 = v$251[1];
var wallclock$228;
try {wallclock$228 = (basis$Timer$.checkRealTimer$111(rt$80[0]));
} catch(v$629) {wallclock$228 = ((function(E$231){return basis$Time$.zeroTime$51;
})(v$629));
};
var time_elem$233 = [basis$Time$.zeroTime$51,name$212,v$253,v$252,wallclock$228];
var v$450 = time_elem$233[1];
var v$451 = time_elem$233[2];
try {var v$452 = tools$Flags$$1.timings_stream$99[0];
switch (v$452[0]) { case 0: {var v$453 = v$452[1];
try {basis$TextIO$.output$101(v$453,((v$450 + " ") + (basis$Time$.toString$141(v$451[0],v$451[1]))) + "\n");
0;
} catch(v$631) {(function(v$458){return tools$Crash$.impossible$50("Timing.maybe_export_timings.I could not write timings to timings stream");
})(v$631);
};
 break; }default: {0;
} };
} catch(v$630) {(function(E$461){basis$General$.print$156(("Function maybe_export_timings raises exception " + E$461[0]) + "\n");
throw E$461;
})(v$630);
};
var t$633 = timings$83;
var t$632;
var v$245 = timings$83[0];
if (v$245 == null) {t$632 = [["Unknown",[time_elem$233,null]],null];
} else {var v$246 = v$245;
var v$247 = v$246[0];
var v$248 = v$247[0];
var v$249 = v$247[1];
var v$250 = v$246[1];
t$632 = [[v$248,insert_time_elem$149(v$249,time_elem$233)],v$250];
};
(t$633[0] = t$632,0);
return 0;
};
};
} catch(v$628) {return (function(E$256){basis$General$.print$156(("Function timing_end raises exception " + E$256[0]) + "\n");
throw E$256;
})(v$628);
};
} else {return 0;
};
};
tools$Timing$.timing_end_res$261 = function(v$268,v$269){tools$Timing$.timing_end$209(v$268);
return v$269;
};
tools$Timing$.timing$270 = function(name$273,f$276,a$279){if (compiler_timings$72[0]) {if (timingNow$81[0]) {(timer_nesting$82[0] = (SmlPrims.chk_ovf_i32(timer_nesting$82[0] + 1)),0);
} else {(t$79[0] = (basis$Timer$.startCPUTimer$79(0)),0);
(timingNow$81[0] = true,0);
(rt$80[0] = (SmlPrims.getrealtime()),0);
};
} else {0;
};
return [f$276(a$279),tools$Timing$.timing_end$209(name$273)][0];
};
tools$Timing$.new_file$282 = function(filename$285){if (timingNow$81[0]) {return tools$Crash$.impossible$50("Timing.You have called Timing.new_file while a timer is active.");
} else {return (timings$83[0] = [[filename$285,null],timings$83[0]],0);
};
};
tools$Timing$.reset_timings$293 = function(v$295){(timings$83[0] = null,0);
return (timingNow$81[0] = false,0);
};
tools$Timing$.empty_local_time$298 = function(v$300){return [basis$Time$.zeroTime$51];
};
var local_timer$301 = [basis$Timer$.startCPUTimer$79(0)];
var local_timer_on$302 = [false];
tools$Timing$.local_timing_begin$303 = function(v$305){if (local_timer_on$302[0]) {return tools$Crash$.impossible$50("Timing.Local timer already started.");
} else {(local_timer_on$302[0] = true,0);
return (local_timer$301[0] = (basis$Timer$.startCPUTimer$79(0)),0);
};
};
tools$Timing$.local_timing_end$312 = function(timer$315){var t$639 = timer$315;
var t$638;
var t$637 = basis$Time$.s$f$288;
var t$636 = timer$315[0];
var t$635;
var t$634;
var v$625 = local_timer$301[0];
t$634 = (basis$Timer$.checkCPUTimer$82(v$625[0],v$625[1],v$625[2]));
t$635 = t$634[1];
t$638 = (t$637(t$636,t$635));
(t$639[0] = t$638,0);
return (local_timer_on$302[0] = false,0);
};
tools$Timing$.reset_local_time$322 = function(timer$325){return (timer$325[0] = basis$Time$.zeroTime$51,0);
};
tools$Timing$.pp_local_timing$326 = function(timer$329){try {var s$496;
var v$626 = timer$329[0];
s$496 = (basis$Time$.toString$141(v$626[0],v$626[1]));
var ssize$497 = s$496.length;
var fix$641 = {};
fix$641.$f = function(v$499){switch (v$499) { case 0: {return null;
 break; }default: {return [32,fix$641.$f(SmlPrims.chk_ovf_i32(v$499 - 1))];
} };
};
var f$498 = fix$641.$f;
return (15 <= ssize$497)?s$496:(SmlPrims.concat([SmlPrims.implode(f$498(SmlPrims.chk_ovf_i32(15 - ssize$497))),[s$496,null]]));
} catch(v$640) {return (function(E$332){basis$General$.print$156(("Function pp_local_timing raises exception " + E$332[0]) + "\n");
throw E$332;
})(v$640);
};
};
return 0;
})();
