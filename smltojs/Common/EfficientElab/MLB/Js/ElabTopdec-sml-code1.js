if ((typeof(basics$ElabTopdec$$1)) == "undefined") {basics$ElabTopdec$$1 = {};
};
(function(){basics$ElabTopdec$$1.impossible$53 = function(s$56){return tools$Crash$.impossible$50("ElabTopdec." + s$56);
};
basics$ElabTopdec$$1.noSome$57 = function(v$60,v$63){switch (v$60[0]) { case 1: {return tools$Crash$.impossible$50("ElabTopdec." + v$63);
 break; }default: {return v$60[1];
} };
};
basics$ElabTopdec$$1.quote$75 = function(s$78){return ("`" + s$78) + "'";
};
basics$ElabTopdec$$1.is_Some$79 = function(v$82){switch (v$82[0]) { case 1: {return false;
 break; }default: {return true;
} };
};
basics$ElabTopdec$$1.StringTree_to_string$89 = function(v$1059){return tools$PrettyPrint$.flatten1$388(v$1059);
};
var fix$1062 = {};
fix$1062.$pp_list = function(v$93,v$96){lab$pp_list: while (true) {if (v$96 == null) {return "";
} else {var v$116 = v$96;
var v$117 = v$116[1];
if (v$117 == null) {var v$119 = v$116[0];
return v$93(v$119);
} else {var v$120 = v$117;
if (v$120[1] == null) {var v$123 = v$116[0];
var v$124 = v$120[0];
return ((v$93(v$123)) + " and ") + (v$93(v$124));
} else {var v$126 = v$116[0];
return ((v$93(v$126)) + ", ") + (fix$1062.$pp_list(v$93,v$117));
};
};
};
};
};
basics$ElabTopdec$$1.pp_list$90 = fix$1062.$pp_list;
basics$ElabTopdec$$1.oo$127 = function(v$132,v$133){return basics$StatObject$.oo$4663(v$132,v$133);
};
basics$ElabTopdec$$1.B_plus_E$134 = function(v$139,v$140){return basics$ModuleEnvironments$.plus_E$528(v$139,v$140);
};
basics$ElabTopdec$$1.B_plus_B$141 = function(v$146,v$147){return basics$ModuleEnvironments$.plus$406(v$146,v$147);
};
basics$ElabTopdec$$1.G_plus_G$148 = function(v$153,v$154){return basics$ModuleEnvironments$.plus$75(v$153,v$154);
};
basics$ElabTopdec$$1.B_plus_G$155 = function(v$160,v$161){return basics$ModuleEnvironments$.plus_G$582(v$160,v$161);
};
basics$ElabTopdec$$1.E_plus_E$162 = function(v$167,v$168){return basics$Environments$.plus$2381(v$167,v$168);
};
basics$ElabTopdec$$1.F_plus_F$169 = function(v$174,v$175){return basics$ModuleEnvironments$.plus$235(v$174,v$175);
};
basics$ElabTopdec$$1.B_plus_F$176 = function(v$181,v$182){return basics$ModuleEnvironments$.plus_F$618(v$181,v$182);
};
basics$ElabTopdec$$1.SE_plus_SE$183 = function(v$188,v$189){return basics$Environments$.plus$2115(v$188,v$189);
};
basics$ElabTopdec$$1.s$n$191 = function(x$194){return basis$List$.s$n$645(x$194);
};
basics$ElabTopdec$$1.tynames_E$195 = function(E$198){return basics$Environments$.tynames$2531(E$198);
};
basics$ElabTopdec$$1.tynames_G$199 = function(G$202){return basics$ModuleEnvironments$.tynames$95(G$202);
};
basics$ElabTopdec$$1.tynames_F$203 = function(F$206){return basics$ModuleEnvironments$.tynames$255(F$206);
};
basics$ElabTopdec$$1.tyvars_Type$207 = function(tau$210){return basics$StatObject$.tyvars$1912(tau$210);
};
basics$ElabTopdec$$1.tyvars_B$$211 = function(B$214){return basics$ModuleEnvironments$.tyvars$$471(B$214);
};
basics$ElabTopdec$$1.pr_Env$215 = function(E$218){return tools$PrettyPrint$.outputTree$1071([function(v$1060){return basis$General$.print$156(v$1060);
},basics$Environments$.layout$2532(E$218),120]);
};
basics$ElabTopdec$$1.okConv$219 = function(v$1061){return basics$ElabInfo$.from_ParseInfo$221(v$1061);
};
basics$ElabTopdec$$1.errorConv$220 = function(v$225,v$226){return basics$ElabInfo$.plus_ErrorInfo$92(basics$ElabInfo$.from_ParseInfo$221(v$225),v$226);
};
basics$ElabTopdec$$1.typeConv$227 = function(v$232,v$233){return basics$ElabInfo$.plus_TypeInfo$118(basics$ElabInfo$.from_ParseInfo$221(v$232),v$233);
};
basics$ElabTopdec$$1.repeatedIdsError$234 = function(v$239,v$240){var v$998 = [24,v$240];
return basics$ElabInfo$.plus_ErrorInfo$92(basics$ElabInfo$.from_ParseInfo$221(v$239),v$998);
};
basics$ElabTopdec$$1.repeaters$241 = function(eq$244,ys$247){var fix$1063 = {};
fix$1063.$filter = function(v$768){if (v$768 == null) {return null;
} else {var v$769 = v$768;
var v$770 = v$769[0];
var v$771 = v$769[1];
var t$1066;
var t$1065;
var fix$1064 = {};
fix$1064.$occurences = function(v$1032){if (v$1032 == null) {return 0;
} else {var v$1033 = v$1032;
var v$1034 = v$1033[0];
var v$1035 = v$1033[1];
return SmlPrims.chk_ovf_i32(((eq$244([v$770,v$1034]))?1:0) + (fix$1064.$occurences(v$1035)));
};
};
var occurences$1031 = fix$1064.$occurences;
t$1065 = (occurences$1031(ys$247));
t$1066 = (t$1065 > 1);
if (t$1066) {return [v$770,fix$1063.$filter(v$771)];
} else {return fix$1063.$filter(v$771);
};
};
};
var filter$767 = fix$1063.$filter;
return filter$767(ys$247);
};
basics$ElabTopdec$$1.member$276 = function(v$750,x$279,xs$282){var fix$1067 = {};
fix$1067.$exists = function(v$777){lab$exists: while (true) {if (v$777 == null) {return false;
} else {var v$778 = v$777;
var v$779 = v$778[0];
var v$780 = v$778[1];
if (v$750([x$279,v$779])) {return true;
} else {var t$1068 = v$780;
var v$777 = t$1068;
continue lab$exists;
};
};
};
};
var exists$776 = fix$1067.$exists;
return exists$776(xs$282);
};
basics$ElabTopdec$$1.Sigma_match$286 = function(v$296,v$297,v$298){try {return [basics$ElabInfo$.from_ParseInfo$221(v$296),basics$ModuleStatObject$.match$594(v$297,v$298)];
} catch(v$1069) {return (function(v$295){var t$1070 = v$295;
if (t$1070[0] == basics$ModuleStatObject$.en$No_match$88) {var reason$292 = v$295[1];
var t$1071;
var v$1004 = [19,reason$292];
t$1071 = (basics$ElabInfo$.plus_ErrorInfo$92(basics$ElabInfo$.from_ParseInfo$221(v$296),v$1004));
return [t$1071,basics$ModuleStatObject$.instance$513(v$297)];
} else {throw v$295;
};
})(v$1069);
};
};
basics$ElabTopdec$$1.Sigma_match$$299 = function(v$325,v$326,v$327){try {var v$310 = basics$ModuleStatObject$.match$$613(v$326,v$327);
var v$311 = v$310[0];
var v$312 = v$310[1];
var v$313 = v$310[2];
var v$314 = v$310[3];
return [basics$ElabInfo$.from_ParseInfo$221(v$325),v$311,v$312,v$313,v$314];
} catch(v$1072) {return (function(v$318){var t$1073 = v$318;
if (t$1073[0] == basics$ModuleStatObject$.en$No_match$88) {var reason$315 = v$318[1];
var v$322 = basics$ModuleStatObject$.instance$$524(v$326);
var v$323 = v$322[0];
var v$324 = v$322[1];
var t$1074;
var v$1006 = [19,reason$315];
t$1074 = (basics$ElabInfo$.plus_ErrorInfo$92(basics$ElabInfo$.from_ParseInfo$221(v$325),v$1006));
return [t$1074,v$324,v$323,v$324,basics$StatObject$.Id$4212];
} else {throw v$318;
};
})(v$1072);
};
};
var fix$1075 = {};
fix$1075.$initial_TE = function(v$331){lab$initial_TE: while (true) {var v$345 = v$331[1];
var v$346 = v$345[1];
var v$347 = v$345[2];
var v$348 = v$345[4];
var TE$337 = basics$Environments$.init$1986(v$346,v$347);
switch (v$348[0]) { case 1: {return TE$337;
 break; }default: {var v$344 = v$348[1];
var TE$$343 = fix$1075.$initial_TE(v$344);
return basics$Environments$.plus$1769(TE$337,TE$$343);
} };
};
};
basics$ElabTopdec$$1.initial_TE$328 = fix$1075.$initial_TE;
basics$ElabTopdec$$1.Sigma_instance$$349 = function(a$352){return basics$ModuleStatObject$.instance$$524(a$352);
};
basics$ElabTopdec$$1.wellformed_TyStr$354 = function(tystr$387){var v$395 = basics$Environments$.to_theta_and_VE$1659(tystr$387);
var v$396 = v$395[0];
var v$397 = v$395[1];
if (basics$StatObject$.is_TyName$4012(v$396)) {return true;
} else {return basics$Environments$.is_empty$1153(v$397);
};
};
basics$ElabTopdec$$1.wellformed_TE$355 = function(TE$374){return basics$Environments$.fold$1817(function(tystr$377){return function(bool$380){if (bool$380) {var v$797 = basics$Environments$.to_theta_and_VE$1659(tystr$377);
var v$798 = v$797[0];
var v$799 = v$797[1];
if (basics$StatObject$.is_TyName$4012(v$798)) {return true;
} else {return basics$Environments$.is_empty$1153(v$799);
};
} else {return false;
};
};
},true,TE$374);
};
var fix$1076 = {};
fix$1076.$wellformed_E = function(E$359){var v$368 = basics$Environments$.un$2322(E$359);
var v$369 = v$368[0];
var v$370 = v$368[1];
if (fix$1076.$wellformed_SE(v$369)) {return basics$Environments$.fold$1817(function(tystr$801){return function(bool$802){if (bool$802) {var v$804 = basics$Environments$.to_theta_and_VE$1659(tystr$801);
var v$805 = v$804[0];
var v$806 = v$804[1];
if (basics$StatObject$.is_TyName$4012(v$805)) {return true;
} else {return basics$Environments$.is_empty$1153(v$806);
};
} else {return false;
};
};
},true,v$370);
} else {return false;
};
};
fix$1076.$wellformed_SE = function(SE$400){return basics$Environments$.fold$2157(function(E$403){return function(bool$406){if (bool$406) {return fix$1076.$wellformed_E(E$403);
} else {return false;
};
};
},true,SE$400);
};
basics$ElabTopdec$$1.wellformed_E$356 = fix$1076.$wellformed_E;
basics$ElabTopdec$$1.wellformed_SE$353 = fix$1076.$wellformed_SE;
basics$ElabTopdec$$1.en$Share$411 = new String("Share");
basics$ElabTopdec$$1.update$412 = function(v$751,v$417){var v$425 = v$417[0];
var v$426 = v$417[1];
var v$427 = v$417[2];
var v$422 = tools$FinMap$.lookup$67(v$751,v$427,v$425);
switch (v$422[0]) { case 0: {var v$424 = v$422[1];
return tools$FinMap$.add$132(v$751,[v$425,[v$426,v$424],v$427]);
 break; }default: {return tools$FinMap$.add$132(v$751,[v$425,[v$426,null],v$427]);
} };
};
basics$ElabTopdec$$1.collect_TE$428 = function(v$508,v$509,v$510,v$511){var tcmap$435;
var fix$1077 = {};
fix$1077.$foldl = function(v$821,v$822){if (v$822 == null) {return v$821;
} else {var v$823 = v$822;
var v$824 = v$823[0];
var v$825 = v$823[1];
return fix$1077.$foldl(basics$Environments$.Fold$1836(function(v$836){var v$837 = v$836[0];
var v$838 = v$836[1];
return function(acc$839){var v$845 = tools$FinMap$.lookup$67(function(v$1036){return syntax_objects$TyCon$.eq_tycon$215(v$1036[0],v$1036[1]);
},acc$839,v$837);
switch (v$845[0]) { case 0: {var v$846 = v$845[1];
return tools$FinMap$.add$132(function(v$1037){return syntax_objects$TyCon$.eq_tycon$215(v$1037[0],v$1037[1]);
},[v$837,[v$838,v$846],acc$839]);
 break; }default: {return tools$FinMap$.add$132(function(v$1038){return syntax_objects$TyCon$.eq_tycon$215(v$1038[0],v$1038[1]);
},[v$837,[v$838,null],acc$839]);
} };
};
},v$821,v$824),v$825);
};
};
var foldl$820 = fix$1077.$foldl;
var v$1051 = tools$FinMap$.empty$52(function(v$1039){return syntax_objects$TyCon$.eq_tycon$215(v$1039[0],v$1039[1]);
});
tcmap$435 = (foldl$820(v$1051,v$510));
return tools$FinMap$.Fold$472(function(v$1040){return syntax_objects$TyCon$.eq_tycon$215(v$1040[0],v$1040[1]);
},function(v$464){var v$465 = v$464[0];
var v$466 = v$465[1];
if (v$466 == null) {return v$464[1];
} else {var v$469 = v$466;
if (v$469[1] == null) {return v$464[1];
} else {var v$506 = v$465[0];
var v$507 = v$464[1];
var tynames$485;
var fix$1078 = {};
fix$1078.$map = function(v$850){if (v$850 == null) {return null;
} else {var v$851 = v$850;
var v$852 = v$851[0];
var v$853 = v$851[1];
var t$1080;
var t$1079;
var theta$1028 = basics$Environments$.to_theta$1670(v$852);
var v$1029 = basics$StatObject$.to_TyName$3950(theta$1028);
switch (v$1029[0]) { case 1: {throw [basics$ElabTopdec$$1.en$Share$411,[21,[syntax_objects$TyCon$.implode_LongTyCon$90(basis$List$.rev$641(v$509),v$506),theta$1028]]];
 break; }default: {t$1079 = v$1029[1];
} };
t$1080 = [t$1079,fix$1078.$map(v$853)];
return t$1080;
};
};
var map$849 = fix$1078.$map;
tynames$485 = (map$849(v$466));
var arity$486 = (tynames$485 == null)?(tools$Crash$.impossible$50("ElabTopdec.SHAREspec.collect")):tynames$485[0][0];
var fix$1081 = {};
fix$1081.$app = function(v$866){lab$app: while (true) {if (v$866 == null) {return 0;
} else {var v$867 = v$866;
var v$868 = v$867[0];
var v$869 = v$867[1];
if (v$868[0] == arity$486) {if (v$508(v$868)) {0;
} else {throw [basics$ElabTopdec$$1.en$Share$411,[20,[syntax_objects$TyCon$.implode_LongTyCon$90(basis$List$.rev$641(v$509),v$506),v$868]]];
};
} else {throw [basics$ElabTopdec$$1.en$Share$411,[22,tynames$485]];
};
var t$1082 = v$869;
var v$866 = t$1082;
continue lab$app;
};
};
};
var app$865 = fix$1081.$app;
app$865(tynames$485);
return [tynames$485,v$507];
};
};
},v$511,tcmap$435);
};
var fix$1083 = {};
fix$1083.$collect_E = function(v$544,v$545,v$546,v$547){var v$524;
var fix$1105 = {};
fix$1105.$foldl = function(v$929,v$930){lab$foldl: while (true) {if (v$930 == null) {return v$929;
} else {var v$931 = v$930;
var v$932 = v$931[0];
var v$933 = v$931[1];
var t$1106;
var v$937 = v$929[0];
var v$938 = v$929[1];
var v$939 = basics$Environments$.un$2322(v$932);
t$1106 = [[v$939[0],v$937],[v$939[1],v$938]];
var t$1107 = t$1106;
var t$1108 = v$933;
var v$929 = t$1107;
var v$930 = t$1108;
continue lab$foldl;
};
};
};
var foldl$928 = fix$1105.$foldl;
var v$1055 = [null,null];
v$524 = (foldl$928(v$1055,v$546));
var v$525 = v$524[0];
var v$526 = v$524[1];
var acc$523 = fix$1083.$collect_SE(v$544,v$545,v$525,v$547);
return basics$ElabTopdec$$1.collect_TE$428(v$544,v$545,v$526,acc$523);
};
fix$1083.$collect_SE = function(v$595,v$596,v$597,v$598){var smap$554;
var fix$1104 = {};
fix$1104.$foldl = function(v$886,v$887){if (v$887 == null) {return v$886;
} else {var v$888 = v$887;
var v$889 = v$888[0];
var v$890 = v$888[1];
return fix$1104.$foldl(basics$Environments$.Fold$2176(function(v$901){var v$902 = v$901[0];
var v$903 = v$901[1];
return function(acc$904){var v$910 = tools$FinMap$.lookup$67(function(v$1041){return syntax_objects$StrId$.eq_strid$172(v$1041[0],v$1041[1]);
},acc$904,v$902);
switch (v$910[0]) { case 0: {var v$911 = v$910[1];
return tools$FinMap$.add$132(function(v$1042){return syntax_objects$StrId$.eq_strid$172(v$1042[0],v$1042[1]);
},[v$902,[v$903,v$911],acc$904]);
 break; }default: {return tools$FinMap$.add$132(function(v$1043){return syntax_objects$StrId$.eq_strid$172(v$1043[0],v$1043[1]);
},[v$902,[v$903,null],acc$904]);
} };
};
},v$886,v$889),v$890);
};
};
var foldl$885 = fix$1104.$foldl;
var v$1053 = tools$FinMap$.empty$52(function(v$1044){return syntax_objects$StrId$.eq_strid$172(v$1044[0],v$1044[1]);
});
smap$554 = (foldl$885(v$1053,v$597));
return tools$FinMap$.Fold$472(function(v$1045){return syntax_objects$StrId$.eq_strid$172(v$1045[0],v$1045[1]);
},function(v$583){var v$584 = v$583[0];
var v$585 = v$584[1];
if (v$585 == null) {return v$583[1];
} else {var v$588 = v$585;
if (v$588[1] == null) {return v$583[1];
} else {var v$593 = v$584[0];
var v$594 = v$583[1];
return fix$1083.$collect_E(v$595,[v$593,v$596],v$585,v$594);
};
};
},v$598,smap$554);
};
basics$ElabTopdec$$1.collect_E$513 = fix$1083.$collect_E;
basics$ElabTopdec$$1.collect_SE$512 = fix$1083.$collect_SE;
var fix$1084 = {};
fix$1084.$collapse = function(v$611,v$1046){if (v$611 == null) {return v$1046;
} else {var v$656 = v$611;
var v$657 = v$656[0];
var v$658 = v$656[1];
var fix$1094 = {};
fix$1094.$split = function(v$627,v$1047,v$1048){lab$split: while (true) {if (v$627 == null) {return [v$1047,v$1048];
} else {var v$634 = v$627;
var v$635 = v$634[0];
var v$636 = v$634[1];
if (special_objects$TyName$$3.isEmpty$2409(special_objects$TyName$$3.intersect$2726(v$635,v$657))) {var t$1095 = v$636;
var t$1096 = [v$635,v$1047];
var t$1097 = v$1048;
var v$627 = t$1095;
var v$1047 = t$1096;
var v$1048 = t$1097;
continue lab$split;
} else {var t$1098 = v$636;
var t$1099 = v$1047;
var t$1100 = [v$635,v$1048];
var v$627 = t$1098;
var v$1047 = t$1099;
var v$1048 = t$1100;
continue lab$split;
};
};
};
};
var split$613 = fix$1094.$split;
var v$645 = split$613(v$658,null,null);
var v$646 = v$645[1];
if (v$646 == null) {var v$647 = v$645[0];
return fix$1084.$collapse(v$647,[v$657,v$1046]);
} else {var v$655 = v$645[0];
var Tnew$648;
var fix$1101 = {};
fix$1101.$foldl = function(v$947,v$948){lab$foldl: while (true) {if (v$948 == null) {return v$947;
} else {var v$949 = v$948;
var v$950 = v$949[0];
var v$951 = v$949[1];
var t$1102 = special_objects$TyName$$3.union$2587(v$950,v$947);
var t$1103 = v$951;
var v$947 = t$1102;
var v$948 = t$1103;
continue lab$foldl;
};
};
};
var foldl$946 = fix$1101.$foldl;
Tnew$648 = (foldl$946(v$657,v$646));
return fix$1084.$collapse([Tnew$648,v$655],v$1046);
};
};
};
basics$ElabTopdec$$1.collapse$599 = fix$1084.$collapse;
var fix$1085 = {};
fix$1085.$find = function(v$676,v$1049){lab$find: while (true) {if (v$676 == null) {return tools$Crash$.impossible$50("ElabTopdec.IG.SHARINGspec.find");
} else {var v$678 = v$676;
var v$679 = v$678[1];
if (v$679 == null) {return [v$678[0],v$1049];
} else {var v$686 = v$678[0];
if (v$686[1]) {var t$1087 = v$686;
var t$1086;
var x$958 = [v$679,v$1049];
t$1086 = (basis$List$.s$n$645(x$958));
return [t$1087,t$1086];
} else {var t$1088 = v$679;
var t$1089 = [v$686,v$1049];
var v$676 = t$1088;
var v$1049 = t$1089;
continue lab$find;
};
};
};
};
};
basics$ElabTopdec$$1.find$660 = fix$1085.$find;
var fix$1090 = {};
fix$1090.$build = function(v$691){if (v$691 == null) {return [null,basics$StatObject$.Id$4212];
} else {var v$711 = v$691;
var v$712 = v$711[0];
var v$713 = v$711[1];
var v$708 = basics$ElabTopdec$$1.find$660(v$712,null);
var v$709 = v$708[0];
var v$710 = v$708[1];
var phi$701 = basics$StatObject$.from_T_and_tyname$4228(special_objects$TyName$$3.fromList$2946(v$710),v$709);
var v$705 = fix$1090.$build(v$713);
var v$706 = v$705[0];
var v$707 = v$705[1];
var t$1093;
var x$959 = [v$710,v$706];
t$1093 = (basis$List$.s$n$645(x$959));
return [t$1093,basics$StatObject$.oo$4663(v$707,phi$701)];
};
};
basics$ElabTopdec$$1.build$688 = fix$1090.$build;
basics$ElabTopdec$$1.share$714 = function(v$721,v$722){var Ts$719;
var l$964 = basics$ElabTopdec$$1.collect_E$513(v$721,null,v$722,null);
var fix$1091 = {};
fix$1091.$map = function(v$966){if (v$966 == null) {return null;
} else {var v$967 = v$966;
var v$968 = v$967[0];
var v$969 = v$967[1];
return [special_objects$TyName$$3.fromList$2946(v$968),fix$1091.$map(v$969)];
};
};
var map$965 = fix$1091.$map;
Ts$719 = (map$965(l$964));
var Ts$720;
var l$971 = basics$ElabTopdec$$1.collapse$599(Ts$719,null);
var fix$1092 = {};
fix$1092.$map = function(v$973){if (v$973 == null) {return null;
} else {var v$974 = v$973;
var v$975 = v$974[0];
var v$976 = v$974[1];
return [special_objects$TyName$$3.list$2937(v$975),fix$1092.$map(v$976)];
};
};
var map$972 = fix$1092.$map;
Ts$720 = (map$972(l$971));
return basics$ElabTopdec$$1.build$688(Ts$720);
};
basics$ElabTopdec$$1.share$723 = function(v$1050){return basics$ElabTopdec$$1.share$714(v$1050[0],v$1050[1]);
};
return 0;
})();
